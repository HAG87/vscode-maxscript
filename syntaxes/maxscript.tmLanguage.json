{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "maxscript",
	"fileTypes": [ "ms", "mse", "mcr" ],
	"foldingStartMarker": "(-{2})?\\(\\s*$",
	"foldingStopMarker": "^\\s*(-{2})?\\s*\\)",

	"patterns": [
		{ "include": "#braces"},
		{ "include": "#variable"},
		{ "include": "#comment" },
		{ "include": "#keywords" },
		{ "include": "#strings" },
		{ "include": "#numeric" },
		{ "include": "#constant" },
		{ "include": "#meta" },
		{ "include": "#storage" }
	],
	"repository": {
		"braces":{
			"patterns": [
				{
					"name": "punctuation.section.brackets.begin",
					"match": "\\["
				},
				{
					"name": "punctuation.section.brackets.end",
					"match": "\\]"
				},
				{
					"name": "punctuation.section.braces.begin",
					"match": "\\{"
				},
				{
					"name": "punctuation.section.braces.end",
					"match": "\\}"
				},
				{
					"name": "punctuation.section.block.begin",
					"match": "\\("
				},
				{
					"name": "punctuation.section.block.end",
					"match": "\\)"
				}
			]
		},
		"comment": {
			"patterns": [
				{
					"name": "comment.line.maxscript",
					"begin":"--",
					"end":"$",
					"captures": {
						"1":{"name":"punctuation.definition.comment.maxscript"}
					}
				},
				{
					"name":"comment.block.maxscript",
					"begin": "/\\*",
					"end":"\\*/",
					"captures":{
						"1":{"name":"punctuation.definition.comment.maxscript"}
					}
				}
			]
		},
		"keywords": {
			"patterns": [
				{
					"name":"keyword.operator.maxscript",
					"match": "(?i)(?:(\\+=?|\\*=?|-=?|\\/=?|\\^|!?=|={1,2}|<=?|>=?))"
				},
				{
					"name":"keyword.operator.linebreak.maxscript",
					"match": "(?i)(\\\\)"
				},
				{
					"name": "keyword.operator.statement.maxscript",
					"match": ";"
				},
				{
					"name": "keyword.operator.delimiter.maxscript",
					"match": "[,\\.](?!\\d)"
				},
				{
					"name":"keyword.control.assign.maxscript",
					"match": "(?<!:):(?=[^:]|:{2}[^:])"
				},
				{
					"name":"keyword.operator.word.maxscript",
					"match": "(?i)(?<![.$])\\b(and|at|as|by|in|not|or|to)\\b"
				},
				{
					"name": "keyword.control.maxscript",
					"match": "(?i)\\b(case|catch|collect|continue|do|of|else|exit|for|if|return|set|then|throw|try|undo|when|where|while|with|dontcollect)\\b"
				},
				{
					"name":  "keyword.other.maxscript",
					"match": "(?i)\\b(max|animate|from)\\b"
				},
				{
					"name":"keyword.operator.definition.byref.maxscript",
					"match": "(&)(?=\\w)"
				}
			]
		},
		"strings": {
			"patterns": [
				{
					"name":"string.localized.maxscript",
					"begin": "~",
					"end": "~",
					"captures": {
						"0": {"name":"punctuation.definition.localized.maxscript"}
					},
					"patterns": [
						{
							"name":  "constant.character.escape.maxscript",
							"match": "\\\\(\\*|\\?|\\\\|\\')"
						}
					]
				},
				{
					"name": "string.quoted.double.maxscript",
					"begin": "(?<!@)\"",
					"end": "\"",
					"beginCaptures": {
						"0": {"name":"string.begin.maxscript" }
					},
					"endCaptures": {
						"0": {"name":"string.end.maxscript"}
					},
					"patterns": [
						{
							"name": "constant.character.escape.maxscript",
							"match": "\\\\(\"|n|r|t|\\*|\\?|\\\\|%|x[A-Fa-f0-9]+)"
						}
					]
				},
				{
				"name":  "string.quoted.double.verbatim.maxscript",
				"begin": "(@)(\")",
				"end":   "\"",
				"beginCaptures": {
					"1": {"name": "string.verbatim.operator.maxscript" },
					"2": {"name": "string.begin.maxscript"}
				},
				"endCaptures":   {"0": {"name": "string.end.maxscript" }}
				},
				{
					"name":  "string.quoted.single.maxscript",
					"begin": "'",
					"end":   "'",
					"beginCaptures": {
						"0": {"name":"string.begin.maxscript" }
					},
					"endCaptures": {
						"0": {"name": "string.end.maxscript"}
					},
					"patterns": [{
						"name":  "constant.character.escape.maxscript",
						"match": "\\\\(\\*|\\?|\\\\|\\')"
					}]

				},
				{
					"name":  "string.other.name.maxscript",
					"match": "(#)(?:('[^']*')|(\\w+))",
					"captures": {
						"1": {"name": "string.other.name.begin.maxscript"},
						"2": {"name": "string.other.name.quoted.maxscript"},
						"3": {"name": "string.other.name.unquoted.maxscript"}
					}
				}
			]
		},
		"meta": {
			"patterns":[
				{
					"name":"meta.definition.struct.maxscript",
					"match": "(?i)\\b(struct)\\b\\s+(\\w+)",
					"captures": {
						"1":{"name":"entity.type.struct.maxscript"},
						"2":{"name":"entity.name.struct.maxscript"}
					}
				},
				{
					"name":"meta.definition.function.maxscript",
					"begin":"(?i)\\b((mapped\\s+)?fn|function)\\s+(\\w+)",
					"end":"=",
					"beginCaptures": {
						"1": {"name": "entity.modifier.function.maxscript"},
						"2": {"name": "entity.type.function.maxscript"},
						"3": {"name": "entity.name.function.maxscript"}
					},
					"endCaptures": {
						"0": {"name": "keyword.operator.maxscript"}
					},
					"patterns": [
						{"include": "#variable"},
						{"include": "$self"}
					]
				},
				{
					"name":"meta.definition.event.maxscript",
					"begin": "(?im)^\\s*\\b(on)\\b",
					"end": "(?i)\\b(do|return)\\b",
					"beginCaptures": {
						"1":{"name":"entity.type.event.maxscript"}
					},
					"endCaptures": {
						"1": {"name": "keyword.control.maxscript"}
					},
					"patterns": [
						{
							"match": "(?i)(?<=on)\\s+(\\b\\w+)\\s+(?=\\b(do|return)\\b)",
							"captures": {
								"1":{"name":"entity.name.event.maxscript"}
							}
						},
						{
							"match":"(?i)(?<=on)\\s+(\\b\\w+)\\s+(\\b\\w+)\\s+(?=\\b(do|return)\\b)",
							"captures":{
								"1":{"name":"entity.target.event.maxscript"},
								"2":{"name":"entity.name.event.maxscript"}
							}
						},
						{
							"match":"(?i)(?<=on)\\s+(\\w+\\b)\\s+(\\w+\\b)((?:\\s+(?!do|return)\\w+)+)",
							"captures":{
								"1":{"name":"entity.target.event.maxscript"},
								"2":{"name":"entity.name.event.maxscript"},
								"3":{"name":"entity.argument.event.maxscript"}
							}
						}
					]
				},
				{
					"name": "meta.definition.utility.maxscript",
					"match": "(?i)\\b(macroscript|parameters|plugin|rcmenu|rollout|tool|utility)\\b\\s+(\\w+)",
					"captures": {
						"1":{"name":"entity.type.utility.maxscript"},
						"2":{"name":"entity.name.utility.maxscript"}
					}
				}

			]
		},
		"variable":{
			"patterns": [
				{
					"name":"variable.property.maxscript",
					"match": "(?<=\\.)([0-9]*[A-Za-z_]+\\w*)\\b"
				},
				{
					"match": "\\b([0-9]*[A-Za-z_]+\\w*)(?:[:])\\s*",
					"captures": {
						"1":{"name":"variable.parameter.maxscript"}
					}
				},
				{
					"name":"variable.language.maxscript",
					"match": "(?i)\\b(this)\\b"
				},
				{
					"name": "variable.other.maxscript",
					"comment": "Matches keyword assignment in function calls and definitions (e.g., fn add flag:#optional)",
					"match":   "\\b(\\w+)\\b\\s*(?=:[^:])",
					"captures": {
						"1":{"name":"variable.other.name.maxscript"}
					}
				},
				{
					"name": "variable.definition.global.maxscript",
					"match": "(:{2})(\\w+)"
				}
			]
		},
		"constant":{
			"patterns": [
				{
					"name": "constant.numeric.integer.maxscript",
					"match": "(?<!\\.)\\b[+-]?\\d+[lLpP]?(?!\\.)\\b"
				},
				{
					"name":"constant.numeric.float.maxscript",
					"match": "\\b\\d+\\.\\d+([EeDd][+-]?\\d+)?"
				},
				{
					"name":"constant.numeric.float.no-trailing.maxscript",
					"match": "\\b(\\d+)(\\.)(?!\\w)"
				},
				{
					"name":  "constant.numeric.float.no-leading.maxscript",
					"match": "(?<!\\w)(\\.\\d+([EeDd][+-]?\\d+)?)"
				},
				{
					"name":  "constant.numeric.time.maxscript",
					"match": "(?<!\\w|\\.)(?:\\d*\\.\\d+|\\d+\\.?\\d*)[msft](?:(?:\\d+|\\d*\\.\\d*)[msft])*"
				},
				{
					"name":  "constant.numeric.time.smpte.maxscript",
					"match": "(?<!\\w)\\d+:\\d*\\.\\d*(?!\\w)"
				},
				{
					"name":  "constant.numeric.time.normalised.maxscript",
					"match": "(?<!\\w|\\.)(?:\\d*\\.\\d+|\\d+\\.?\\d*)n(?!\\w)"
				},
				{
					"name":  "constant.language.boolean.maxscript",
					"match": "(?i)\\b(true|on|false|off)\\b"
				},
				{
					"name":  "constant.language.math.maxscript",
					"match": "(?i)\\b(pi|e)\\b"
				},
				{
					"name":  "constant.language.colour.maxscript",
					"match": "(?i)\\b(red|green|blue|white|black|orange|yellow|brown|gray)\\b"
				},
				{
					"name":  "constant.language.axis.maxscript",
					"match": "(?i)\\b([xyz]_axis)\\b"
				},
				{
					"name":  "constant.language.null.maxscript",
					"match": "(?i)\\b(undefined|unsupplied|silentvalue|ok)\\b"
				},
				{
					"name": "constant.other.hex.maxscript",
					"match": "\\b(0x\\w+)\\b"
				},
				{
					"name":"constant.language.pathname.maxscript",
					"begin": "\\$",
					"end": "$",
					"patterns": [{
						"match": "[^ \t\r\n]+"
					}]
				}
			]
		},
		"storage":{
			"patterns": [
				{
					"name": "storage.modifier.maxscript",
					"match": "(?i)\\b(about|coordsys|global|local|private|public|persistent)\\b"
				},
				{
					"name": "storage.type.array.maxscript",
					"begin": "(#)\\s*(\\()",
					"end": "\\)",
					"beginCaptures":{
						"1": {"name": "keyword.definition.array.begin.maxscript"},
						"2": {"name": "punctuation.section.block.begin"}
					},
					"endCaptures":{
						"0": {"name": "punctuation.section.block.end"}
					},
					"patterns": [
						{"include": "$self"},
						{"include": "#braces"}
					]
				},
				{
					"name": "storage.type.bitarray.maxscript",
					"patterns": [{"include": "$self"}],
					"begin": "(#)\\s*(\\{)",
					"end": "\\}",
					"beginCaptures":{
						"1": {"name": "keyword.definition.bit.array.begin.maxscript"},
						"2": {"name": "punctuation.section.braces.begin"}
					},
					"endCaptures":{
						"0": {"name": "punctuation.section.braces.end"}
					}
				},
				{
					"name":  "storage.type.bit-range.maxscript",
					"match": "(?<!\\$)\\b(\\d+)(\\.{2})(\\d+)\\b",
					"captures": {
						"1": {"name": "storage.type.bit-range.begin.maxscript"},
						"2": {"name": "storage.type.bit-range.middle.maxscript"},
						"3": {"name": "storage.type.bit-range.end.maxscript"}
					}
				},
				{
					"name": "storage.type.primitive.maxscript",
					"match": "(?i)\\b(AngleAxis|Array|BigMatrix|BigMatrixRowArray|BinStream|BitArray|Bitmap|Box2|Box3|color|DataPair|Dictionary|Double|EulerAngles|FileStream|Float|HKey|Integer|Integer64|IntegerPtr|Matrix3|MAXKey|mesh|Name|PathName|Point2|Point3|Point4|Quat|Ray|String|StringStream|Time|Timer|TriMesh)\\b"
				},
				{
					"name": "support.variable.ObjectSet.maxscript",
					"match": "(?i)\\b(cameras|geometry|helpers|lights|object|objects|objectSet|primitive|selection|shapes|spacewarps|systems)\\b"
				},
				{
					"name": "support.constant.maxscript",
					"match": "(?i)\\b(\\?|assetUser|Constant|emptyVal|HKEY_CLASSES_ROOT|HKEY_CURRENT_CONFIG|HKEY_CURRENT_USER|HKEY_LOCAL_MACHINE|HKEY_PERFORMANCE_DATA|HKEY_USERS|meditMaterials|selectionSets)\\b"
				},
				{
					"name": "support.class.rollout-control.maxscript",
					"match": "(?i)\\b(angle|button|checkbox|checkbutton|colorpicker|comboBox|curveControl|dotNetControl|dropdownList|editText|group|groupBox|hyperLink|imgTag|label|listBox|mapbutton|materialbutton|menuitem|multilistBox|pickbutton|popUpMenu|progressbar|radiobuttons|SchematicControl|slider|spinner|SubRollout|timer)\\b"
				}
			]
		}
	},
	"scopeName": "source.mxs"
}